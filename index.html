<!doctype html>
<html lang="ru">
<head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XLBMG2GBC2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XLBMG2GBC2');
</script>

<script>
/** <<< НАСТРОЙКА >>> **/
window.DXRT_BOT_ID = "33861362-4d55-4587-91b4-51931ffbe2d1";   // <- впиши сюда botId
// window.DXRT_DEBUG = true;                   // <- опционально: подробные логи в консоль

(function(){
  "use strict";

  /* ==========================
     КОНФИГ И КОНСТАНТЫ
     ========================== */
  const API_HOST = "https://bot-dev.108dev.ru";
  const WS_PATH  = "/api/realtime/backend-proxy";

  const SERVER_AUDIO_RATE  = 24000; // вых. звук бота (pcm16)
  const CAPTURE_AUDIO_RATE = 48000; // микрофон (ресэмплим в 24k)

  const VAD = {                     // клиентский VAD
    START_RMS: 0.020,
    END_RMS:   0.010,
    SILENCE_MS: 600,
    MAX_UTTER_MS: 9000,
    MIN_FRAMES_24K: 12000          // ≈0.5s @24k — гарантируем «осмысленность»
  };

  const IDLE_TIMEOUT_MS = 5 * 60 * 1000; // авто-выключение через 5 минут тишины
  const RECONNECT_STEPS = [1000, 2000, 5000, 10000, 20000, 30000];

  const BOT_ID = window.DXRT_BOT_ID;
  if (!BOT_ID) { console.error("[DXRT] Не задан DXRT_BOT_ID"); return; }
  const DEBUG = !!window.DXRT_DEBUG;

  /* ==========================
     ВСПОМОГАТЕЛЬНОЕ
     ========================== */
  function info(){ if (DEBUG) try{ console.info("[DXRT]", ...arguments);}catch{} }
  function warn(){ try{ console.warn("[DXRT]", ...arguments);}catch{} }
  function err (){ try{ console.error("[DXRT]", ...arguments);}catch{} }

  // cookies (chatId)
  function setCookie(name, value) {
    try { document.cookie = `${name}=${encodeURIComponent(value)}; path=/; SameSite=Lax${location.protocol==="https:"?"; Secure":""}`; } catch {}
  }
  function getCookie(name) {
    try { const m = document.cookie.match(new RegExp("(^| )"+name+"=([^;]+)")); return m ? decodeURIComponent(m[2]) : null; } catch { return null; }
  }
  function getOrCreateChatId(botId){
    const key = "dxrt_chatId_" + botId;
    let cid = getCookie(key);
    if (!cid) { cid = "guest_" + Math.random().toString(36).slice(2); setCookie(key, cid); }
    return cid;
  }

  // base64/pcm helpers
  function floatTo16(f32){ const buf=new ArrayBuffer(f32.length*2), v=new DataView(buf); for(let i=0;i<f32.length;i++){ let s=Math.max(-1,Math.min(1,f32[i])); v.setInt16(i*2, s<0?s*0x8000:s*0x7fff, true);} return new Uint8Array(buf); }
  function bytesToB64(bytes){ let b=""; for(let i=0;i<bytes.length;i++) b+=String.fromCharCode(bytes[i]); return btoa(b); }
  function b64ToInt16(b64){ const bin=atob(b64); const out=new Int16Array(bin.length/2); for(let i=0,j=0;i<bin.length;i+=2,j++){ const lo=bin.charCodeAt(i), hi=bin.charCodeAt(i+1), v=(hi<<8)|lo; out[j]=(v&0x8000)?v-0x10000:v; } return out; }
  function int16ToFloat32(i16){ const o=new Float32Array(i16.length); for(let i=0;i<i16.length;i++) o[i]=Math.max(-1,Math.min(1,i16[i]/32768)); return o; }
  function resampleTo24k(f32, fromRate){
    if (fromRate===24000) return f32;
    if (fromRate===48000){ const o=new Float32Array(Math.floor(f32.length/2)); for(let i=0,j=0;j<o.length;i+=2,j++) o[j]=f32[i]; return o; }
    const ratio=24000/fromRate, outLen=Math.floor(f32.length*ratio), o=new Float32Array(outLen);
    for(let i=0;i<outLen;i++){ const srcPos=i/ratio, i0=Math.floor(srcPos), i1=Math.min(i0+1,f32.length-1), t=srcPos-i0; o[i]=f32[i0]*(1-t)+f32[i1]*t; }
    return o;
  }

  /* ==========================
     UI (Shadow DOM, яркие цвета)
     ========================== */
  const host = document.createElement("div");
  host.id = "dxrt-voice-widget";
  host.style.position = "fixed";
  host.style.zIndex = "2147483647";
  host.style.right = "24px";
  host.style.bottom = "24px";
  document.addEventListener("DOMContentLoaded", () => document.body.appendChild(host));
  const root = host.attachShadow({mode:"open"});
  const css = document.createElement("style");
  css.textContent = `
    :host { all: initial; }
    .wrap { position: relative; }
    .btn {
      all: unset; cursor: pointer; width: 56px; height: 56px; border-radius: 50%;
      display: grid; place-items: center;
      background: radial-gradient(120% 120% at 0% 0%, #ff8a00 0%, #ff3b3b 100%);
      box-shadow: 0 6px 20px rgba(0,0,0,.35);
      transition: transform .12s ease, box-shadow .2s ease, opacity .2s ease;
    }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 8px 26px rgba(0,0,0,.4); }
    .btn.off  { background: radial-gradient(120% 120% at 0% 0%, #7a7a7a 0%, #444 100%); }
    .icon { width: 26px; height: 26px; color: white; }

    .dot { position:absolute; width:12px; height:12px; border-radius:50%; opacity:.9; transform: translateZ(0); }
    .dot.user { background:#34d8ff; right: -4px; top: -4px; }
    .dot.bot  { background:#ff34c4; left:  -4px; bottom:-4px; }
    .pulse { animation: pulse 1.2s infinite; }
    @keyframes pulse {
      0% { box-shadow:0 0 0 0 rgba(255,255,255,.6); }
      70%{ box-shadow:0 0 0 14px rgba(255,255,255,0); }
      100%{ box-shadow:0 0 0 0 rgba(255,255,255,0); }
    }

    .toast{
      position:absolute; right:70px; bottom:8px; max-width:260px;
      background:#10131a; color:#e9eef9; border:1px solid #2b3445;
      border-radius:12px; padding:10px 12px; font: 13px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Arial;
      box-shadow:0 8px 24px rgba(0,0,0,.35);
      display:none;
    }
    .toast.show { display:block; }
    .toast b{ color:#7bc6ff; }
  `;
  const wrap = document.createElement("div"); wrap.className = "wrap";
  const btn  = document.createElement("button"); btn.className = "btn off"; btn.setAttribute("aria-label","Голосовой ассистент");
  btn.innerHTML = `<svg class="icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
    <path d="M12 14a3 3 0 0 0 3-3V6a3 3 0 0 0-6 0v5a3 3 0 0 0 3 3Zm5-3a5 5 0 0 1-10 0H5a7 7 0 0 0 6 6.92V21h2v-3.08A7 7 0 0 0 19 11h-2Z"/>
  </svg>`;
  const dotUser = document.createElement("div"); dotUser.className = "dot user";
  const dotBot  = document.createElement("div"); dotBot.className  = "dot bot";
  const toast   = document.createElement("div"); toast.className   = "toast";
  toast.innerHTML = `Для работы нужен доступ к <b>микрофону</b>. Нажмите «Разрешить» в запросе браузера.`;
  root.appendChild(css); wrap.appendChild(btn); wrap.appendChild(dotUser); wrap.appendChild(dotBot); wrap.appendChild(toast); root.appendChild(wrap);

  function setUserPulse(on){ dotUser.classList.toggle("pulse", !!on); }
  function setBotPulse (on){ dotBot .classList.toggle("pulse", !!on); }
  let toastTimer=null, toastShown=false;
  function showToast(){ if (toastShown) return; toast.classList.add("show"); clearTimeout(toastTimer); toastTimer=setTimeout(()=>toast.classList.remove("show"), 4000); }
  function toastOnce(msg){ toast.innerHTML = msg; toastShown=true; showToast(); }

  /* ==========================
     СОСТОЯНИЕ СЕССИИ
     ========================== */
  let desiredOn = false;     // целевое состояние (вкл/выкл)
  let jwt = null, chatId = getOrCreateChatId(BOT_ID);
  let ws = null, reconnectTry = 0, closingByUser = false;

  // mic
  let audioCtx=null, mediaStream=null, srcNode=null, procNode=null, micOn=false;

  // VAD / бардж-ин
  let speaking=false, utterStartAt=0, lastLoudAt=0, framesInUtter=0, bargeSent=false;

  // bot audio
  let playCtx=null, playbackTime=0, activeNodes=[], muteServerAudio=false, botSpeaking=false;

  // idle
  let lastActivity = Date.now();
  setInterval(() => {
    if (desiredOn && Date.now() - lastActivity > IDLE_TIMEOUT_MS) {
      info("idle timeout → off");
      toggleOff("idle_timeout");
    }
  }, 10000);

  /* ==========================
     СЕТЬ: TOKEN + WS
     ========================== */
  async function getGuestToken(botId, chatId){
    const url = `${API_HOST}/api/websocket/token/guest/${encodeURIComponent(botId)}?chatId=${encodeURIComponent(chatId)}`;
    const res = await fetch(url, { method:"POST" });
    if (!res.ok) throw new Error("token http "+res.status);
    return res.json(); // { token, user }
  }

  function wsSend(obj){
    if (!ws || ws.readyState !== WebSocket.OPEN) return;
    try { ws.send(JSON.stringify(obj)); } catch {}
  }

  function openWS(){
    if (ws && (ws.readyState===WebSocket.OPEN || ws.readyState===WebSocket.CONNECTING)) return;
    const qp = new URLSearchParams({ botId: BOT_ID, token: jwt, preloadMessages: "true", messageLimit: "50" });
    const url = `wss://bot-dev.108dev.ru${WS_PATH}?` + qp.toString();
    info("WS connect", url);
    ws = new WebSocket(url);

    ws.onopen = () => {
      info("WS open");
      reconnectTry = 0;
      wsSend({ type:"session.update", session:{
        modalities:["text","audio"],
        instructions:"Отвечай по сути, без приветствий, кратко.",
        input_audio_format:"pcm16",
        output_audio_format:"pcm16"
      }});
      if (desiredOn && !micOn) startMic();
    };
    ws.onclose = () => {
      info("WS close");
      if (!closingByUser && desiredOn) scheduleReconnect();
    };
    ws.onerror = () => warn("WS error");
    ws.onmessage = (ev) => {
      lastActivity = Date.now();
      let d; try { d = JSON.parse(ev.data); } catch { return; }
      const t = d.type;

      // во время бардж-ина игнорируем хвост предыдущей реплики
      if (muteServerAudio && (t==="response.audio.delta" || t==="response.delta" || t==="response.output_text.delta")) return;

      if (t === "response.audio.delta" && d.delta) {
        botSpeaking = true; setBotPulse(true);
        playAudioChunk(d.delta);
        return;
      }
      if (t === "response.output_text.delta" || t === "response.delta") {
        botSpeaking = true; setBotPulse(true);
        return;
      }
      if (t === "response.completed") {
        botSpeaking = false; setBotPulse(false);
        return;
      }
      if (t === "response.error") {
        botSpeaking = false; setBotPulse(false);
        toastOnce("Ошибка ответа. Попробуйте ещё раз.");
        return;
      }
    };
  }

  function scheduleReconnect(){
    const delay = RECONNECT_STEPS[Math.min(reconnectTry++, RECONNECT_STEPS.length-1)];
    info("reconnect in", delay, "ms");
    setTimeout(async () => {
      if (!desiredOn) return;
      try{
        jwt = (await getGuestToken(BOT_ID, chatId)).token;
        openWS();
      }catch(e){ scheduleReconnect(); }
    }, delay);
  }

  function closeWS(){
    if (!ws) return;
    closingByUser = true;
    try { ws.close(4000, "user"); } catch {}
    ws = null; closingByUser = false;
  }

  /* ==========================
     АУДИО ВЫХОД (бот)
     ========================== */
  function stopAllBotAudio(hard=false){
    try { for (const s of activeNodes) { try { s.stop(0); } catch{} } }
    finally {
      activeNodes = [];
      if (playCtx) {
        try { playbackTime = playCtx.currentTime; } catch{}
        if (hard) { try { playCtx.close(); } catch{} playCtx = null; playbackTime = 0; }
      }
    }
  }

  async function playAudioChunk(b64){
    if (muteServerAudio) return;
    try{
      if (!playCtx) { playCtx = new (window.AudioContext||window.webkitAudioContext)({ sampleRate: SERVER_AUDIO_RATE }); playbackTime = playCtx.currentTime; }
      if (playCtx.state === "suspended") { try { await playCtx.resume(); } catch{} }
      const f32 = int16ToFloat32( b64ToInt16(b64) );
      const buf = playCtx.createBuffer(1, f32.length, SERVER_AUDIO_RATE);
      buf.getChannelData(0).set(f32);
      const src = playCtx.createBufferSource(); src.buffer = buf; src.connect(playCtx.destination);
      activeNodes.push(src);
      src.onended = () => { const i = activeNodes.indexOf(src); if (i>=0) activeNodes.splice(i,1); };
      const now = playCtx.currentTime;
      playbackTime = Math.max(playbackTime, now);
      src.start(playbackTime);
      playbackTime += buf.duration;
    }catch(e){ warn("audio out err", e.message); }
  }

  /* ==========================
     АУДИО ВХОД (микрофон + VAD + бардж-ин)
     ========================== */
  async function startMic(){
    if (micOn) return;
    showToast();
    try {
      const Ctx = window.AudioContext || window.webkitAudioContext;
      audioCtx = audioCtx ?? new Ctx({ sampleRate: CAPTURE_AUDIO_RATE });
    } catch {
      const Ctx = window.AudioContext || window.webkitAudioContext;
      audioCtx = audioCtx ?? new Ctx();
    }
    if (!audioCtx) { toastOnce("AudioContext недоступен"); return; }
    if (audioCtx.state === "suspended") { try { await audioCtx.resume(); } catch{} }

    try {
      mediaStream = await navigator.mediaDevices.getUserMedia({
        audio: { channelCount:1, echoCancellation:true, noiseSuppression:true, autoGainControl:true }
      });
    } catch (e) {
      toastOnce("Нет доступа к микрофону. Разрешите в настройках браузера.");
      return;
    }

    srcNode = audioCtx.createMediaStreamSource(mediaStream);
    procNode = audioCtx.createScriptProcessor(2048, 1, 1);

    framesInUtter = 0; speaking = false; bargeSent = false;

    procNode.onaudioprocess = (e) => {
      if (!micOn) return;
      lastActivity = Date.now();

      const in48 = e.inputBuffer.getChannelData(0);

      // 1) стрим @24k → append
      const f24 = resampleTo24k(in48, audioCtx.sampleRate || CAPTURE_AUDIO_RATE);
      framesInUtter += f24.length;
      const b64 = bytesToB64( floatTo16(f24) );
      wsSend({ type:"input_audio_buffer.append", audio: b64 });

      // 2) клиентский VAD (RMS)
      let sum=0; for (let i=0;i<in48.length;i++){ const s=in48[i]; sum+=s*s; }
      const rms = Math.sqrt(sum / in48.length);
      const t   = performance.now();

      if (!speaking) {
        if (rms >= VAD.START_RMS) {
          speaking = true; utterStartAt = t; lastLoudAt = t;
          setUserPulse(true);

          // Бардж-ин: останавливаем озвучку и глушим хвостовые дельты
          if (!bargeSent && botSpeaking) {
            muteServerAudio = true;
            stopAllBotAudio(true);
            wsSend({ type:"response.cancel" });
            bargeSent = true;
          }
          framesInUtter = 0; // новая фраза
        }
      } else {
        if (rms >= VAD.END_RMS) lastLoudAt = t;

        const longEnough = framesInUtter >= VAD.MIN_FRAMES_24K;
        const silenceOver= (t - lastLoudAt) >= VAD.SILENCE_MS;
        const tooLong    = (t - utterStartAt) >= VAD.MAX_UTTER_MS;

        if (silenceOver || tooLong) {
          speaking = false; setUserPulse(false);
          if (longEnough) {
            wsSend({ type:"input_audio_buffer.commit" });
            wsSend({ type:"response.create" });
            muteServerAudio = false;  // принимаем новую реплику
          }
          framesInUtter = 0; bargeSent = false;
        }
      }
    };

    srcNode.connect(procNode);
    procNode.connect(audioCtx.destination);

    micOn = true;
    btn.classList.remove("off");
  }

  async function stopMic(silent=false){
    if (!micOn && !silent) return;
    try{
      procNode && procNode.disconnect();
      srcNode  && srcNode.disconnect();
      mediaStream && mediaStream.getTracks().forEach(t=>t.stop());
    }catch{}
    procNode=null; srcNode=null; mediaStream=null; micOn=false; setUserPulse(false);
    btn.classList.add("off");
  }

  /* ==========================
     ТОГГЛ ВИДЖЕТА
     ========================== */
  async function toggleOn(){
    if (desiredOn) return;
    desiredOn = true; lastActivity = Date.now();
    try {
      jwt = (await getGuestToken(BOT_ID, chatId)).token;
    } catch(e) {
      toastOnce("Не удалось получить токен. Попробуйте позже.");
      desiredOn = false; return;
    }
    openWS();           // сессия; startMic() вызовется в onopen
  }

  function toggleOff(reason="user"){
    desiredOn = false;
    stopMic(true);
    stopAllBotAudio(true);
    muteServerAudio = false;
    botSpeaking = false; setBotPulse(false);
    closeWS();
  }

  btn.addEventListener("click", () => {
    if (!desiredOn) toggleOn(); else toggleOff("user");
  });

})();
</script>


  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Multiplyr Fridge — холодильник, который приумножает еду</title>
  <meta name="description" content="Холодильник из альтернативной вселенной. Приумножает еду с разными вероятностями. Иногда вместо еды появляется монстр." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0b0c10;--card:#11131a;--muted:#9ca3b5;--text:#eef1f7;--brand:#6ee7ff;--accent:#b388ff;--danger:#ff6e6e;--ok:#7bffb1}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:radial-gradient(1200px 800px at 80% 0%, #162434 0%, var(--bg) 55%), var(--bg);color:var(--text);line-height:1.55}
    a{color:var(--brand);text-decoration:none}
    a:hover{text-decoration:underline}
    .wrap{max-width:1160px;margin:0 auto;padding:24px}
    header{position:sticky;top:0;z-index:10;backdrop-filter:blur(12px);background:linear-gradient(180deg, rgba(11,12,16,.85), rgba(11,12,16,.35));border-bottom:1px solid rgba(255,255,255,.06)}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:12px 24px}
    .logo{display:inline-flex;gap:10px;align-items:center;font-weight:800}
    .dot{width:10px;height:10px;border-radius:50%;background:conic-gradient(from 90deg,var(--brand),var(--accent))}
    .links{display:flex;gap:18px;align-items:center}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:12px 18px;border-radius:14px;background:linear-gradient(180deg,#1a1f2c,#11141c);border:1px solid rgba(255,255,255,.08);color:var(--text);font-weight:600;box-shadow:0 10px 30px rgba(179,136,255,.06)}
    .btn.primary{background:linear-gradient(180deg,#153242,#10202d);border-color:rgba(110,231,255,.35)}
    .btn:hover{box-shadow:0 12px 36px rgba(110,231,255,.15)}
    .hero{display:grid;grid-template-columns:1.15fr .85fr;gap:28px;align-items:center;padding:52px 24px 36px}
    .kicker{color:var(--brand);font-weight:600;letter-spacing:.4px;text-transform:uppercase;font-size:12px}
    h1{font-size:clamp(34px,6vw,60px);line-height:1.05;margin:8px 0 14px}
    .lead{color:var(--muted);font-size:18px;max-width:56ch}
    .cta{display:flex;gap:12px;margin-top:22px;flex-wrap:wrap}
    .hero-card{background:linear-gradient(180deg,#0f1420,#0b0c10);border:1px solid rgba(255,255,255,.07);border-radius:20px;padding:14px;position:relative;box-shadow:0 40px 100px rgba(110,231,255,.05)}
    .hero-img{width:100%;height:420px;object-fit:cover;border-radius:14px;display:block;border:1px solid rgba(255,255,255,.06)}
    .chip{position:absolute;bottom:16px;left:16px;background:rgba(18,21,32,.85);border:1px solid rgba(255,255,255,.08);padding:10px 12px;border-radius:12px;font-size:13px;color:var(--muted)}
    section{padding:64px 24px}
    .section-title{font-size:clamp(26px,4vw,38px);margin:0 0 10px}
    .section-lead{color:var(--muted);max-width:64ch}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-top:26px}
    .card{background:linear-gradient(180deg,#0f131d,#0c0e14);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:20px}
    .card h3{margin:6px 0 6px;font-size:18px}
    .card p{color:var(--muted)}
    .how{display:grid;grid-template-columns:1fr 1fr;gap:18px;align-items:center}
    .how img{width:100%;height:320px;object-fit:cover;border-radius:14px;border:1px solid rgba(255,255,255,.06)}
    .specs{display:grid;grid-template-columns:1.2fr 1fr;gap:18px}
    .bullets{display:grid;gap:12px;margin:12px 0}
    .bullets li{list-style:none;padding-left:12px;position:relative;color:var(--muted)}
    .bullets li::before{content:"";position:absolute;left:-2px;top:8px;width:6px;height:6px;border-radius:50%;background:linear-gradient(90deg,var(--brand),var(--accent))}
    .warning{background:linear-gradient(180deg,#220e12,#16090c);border:1px solid rgba(255,255,255,.08);border-left:6px solid var(--danger);border-radius:16px;padding:18px;color:#ffd6d6}
    .demo{background:linear-gradient(180deg,#0e1726,#0b111b);border:1px solid rgba(110,231,255,.2);border-radius:16px;padding:18px}
    .demo label{color:var(--muted);font-size:14px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    input[type=range]{width:100%}
    .out{margin-top:12px;padding:12px;border-radius:12px;background:#0e1320;border:1px solid rgba(255,255,255,.06);font-family:ui-monospace,Menlo,Consolas,monospace}
    footer{border-top:1px solid rgba(255,255,255,.06);color:var(--muted);padding:32px 24px;text-align:center}
    @media (max-width:980px){.hero{grid-template-columns:1fr}.grid{grid-template-columns:1fr}.how{grid-template-columns:1fr}.specs{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <div class="nav wrap">
      <div class="logo"><span class="dot"></span> Multiplyr Fridge</div>
      <nav class="links">
        <a href="#features">Как это работает</a>
        <a href="#prob">Вероятности</a>
        <a href="#specs">Характеристики</a>
        <a href="#faq">FAQ</a>
        <a class="btn primary" href="#preorder">Предзаказ</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="hero wrap">
      <div>
        <div class="kicker">Вероятностная кухня</div>
        <h1>Холодильник, который приумножает еду</h1>
        <p class="lead">Положите продукты, закройте дверцу, подождите. Откройте и получите иные пропорции, новые блюда или дополнительную порцию. Редко, но вместо еды может появиться монстр. Мы предупредили.</p>
        <div class="cta">
          <a class="btn primary" href="#preorder">Оформить предзаказ</a>
          <a class="btn" href="#prob">Как распределяются шансы</a>
        </div>
      </div>
      <div class="hero-card">
        <!-- IMAGE BRIEF: широкий кадр футуристичной кухни в холодных неоновых оттенках; в центре сияющий холодильник Multiplyr с мягким голубым светом; high‑end sci‑fi; лёгкие частицы; глубина резкости. Соотношение 21:9. -->
        <img id="hero-img" class="hero-img" src="images/hero-multiplyr.jpg" alt="Футуристичная кухня с Multiplyr Fridge" />
        <div class="chip">Алхимия вероятностей у вас дома</div>
      </div>
    </section>

    <section id="features" class="wrap">
      <h2 class="section-title">Как это работает</h2>
      <p class="section-leад">Внутри Multiplyr Fridge работает вероятностный ферментатор с квантовым вкусообразованием. Итог зависит от множества входных сигналов, которые устройство считывает бесконтактно.</p>
      <div class="grid">
        <article class="card">
          <!-- IMAGE BRIEF: крупный план закрытой двери Multiplyr, минималистичный вид, мягкие отблески, эмблема с тонким свечением. 4:3. -->
          <img id="img-closed" src="images/product-closed.png" alt="Multiplyr Fridge, вид спереди" style="width:100%;height:180px;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,.06)" />
          <h3>Шаг 1. Положите еду</h3>
          <p>Фрукты, овощи, заготовки или остатки вчерашнего. Multiplyr считывает текстуры, питательные профили и потенциальные сочетания.</p>
        </article>
        <article class="card">
          <!-- IMAGE BRIEF: интерьер камеры, мягкое сияние, контейнеры, полупрозрачный туман, лабораторная чистота. 4:3. -->
          <img id="img-open" src="images/product-open.png" alt="Multiplyr Fridge, интерьер" style="width:100%;height:180px;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,.06)" />
          <h3>Шаг 2. Закройте дверцу</h3>
          <p>Запускается вероятностная ферментация. Система учитывает внешние и внутренние переменные и подбирает благоприятные сценарии приумножения.</p>
        </article>
        <article class="card">
          <!-- IMAGE BRIEF: коллаж из неожиданных блюд: сливочная паста, миска с фруктами, пирог, роллы; лёгкая глитч‑эстетика; акцент на разнообразии и изобилии. 16:9. -->
          <img id="img-outcomes" src="images/outcomes.png" alt="Разнообразные результаты" style="width:100%;height:180px;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,.06)" />
          <h3>Шаг 3. Откройте и удивляйтесь</h3>
          <p>Получите новые пропорции, дополнительные порции или легкую трансформацию блюда. Иногда выходит идеальный баланс вкусов, иногда экспериментальная вариация.</p>
        </article>
      </div>
    </section>

    <section id="prob" class="wrap">
      <h2 class="section-title">Что влияет на шансы</h2>
      <p class="section-lead">Multiplyr не создаёт из ничего. Он перераспределяет, клонирует текстуры и оформляет вкусы в вероятностном поле. Эти факторы сдвигают результат.</p>
      <div class="grid">
        <article class="card"><h3>Небо и земля</h3><p>Фаза Луны, давление, температура, влажность, индекс солнечной активности.</p></article>
        <article class="card"><h3>Вы и окружение</h3><p>Микровыражения лица, тембр голоса, ритм плейлиста, уровень кофеина, ночные поиски рецептов.</p></article>
        <article class="card"><h3>Дом</h3><p>Мурчание кота в герцах, канал соседского Wi‑Fi, активность закваски, график ближайшего трамвая.</p></article>
        <article class="card"><h3>Космос</h3><p>Космические лучи, ретроградность Меркурия, аномалии Шумана.</p></article>
        <article class="card"><h3>Социальный шум</h3><p>Плотность мемов в ленте, последние чаты о еде, уровень пересылаемости рецептов.</p></article>
        <article class="card"><h3>Хаос</h3><p>Случайный выброс энтропии. Иногда прекрасный. Иногда монстр.</p></article>
      </div>
      <div class="demo" style="margin-top:26px">
        <h3 style="margin:0 0 10px">Мини‑демо вероятностей</h3>
        <p class="section-lead">Поиграйтесь ползунками и посмотрите, как меняются шансы. Это иллюстрация, не реальный алгоритм.</p>
        <div class="row">
          <div>
            <label for="moon">Фаза Луны</label>
            <input id="moon" type="range" min="0" max="100" value="40">
            <label for="weather">Погода (давление)</label>
            <input id="weather" type="range" min="930" max="1040" value="1000">
            <label for="mood">Настроение владельца</label>
            <input id="mood" type="range" min="0" max="100" value="60">
          </div>
          <div>
            <label for="purr">Мурчание кота, Гц</label>
            <input id="purr" type="range" min="20" max="40" value="28">
            <label for="wifi">Канал Wi‑Fi соседа</label>
            <input id="wifi" type="range" min="1" max="13" value="6">
            <label for="cosmic">Космические лучи</label>
            <input id="cosmic" type="range" min="0" max="100" value="35">
          </div>
        </div>
        <div id="out" class="out">…</div>
      </div>
    </section>

    <section id="specs" class="wrap">
      <h2 class="section-title">Характеристики</h2>
      <div class="specs">
        <div>
          <ul class="bullets">
            <li>Объём камеры: 420 л. Вероятностный ферментатор: 2 кассеты.</li>
            <li>Сенсоры: лунометр, барометр, спектрометр мемов, котометр, Wi‑Fi‑сканер, космо‑счётчик.</li>
            <li>Режимы: Деликатный, Праздничный, Ночная кухня, Антимонстр Beta.</li>
            <li>Уровень шума: 19–24 дБ. Потребление: от 33 Вт.</li>
            <li>Защита: авто‑блокировка при повышенном риске монстра.</li>
          </ul>
          <div class="warning" style="margin-top:12px">
            <strong>Важно.</strong> С ненулевой вероятностью вместо еды может появиться монстр. Встроенный модуль Антимонстр снижает риск, но не исключает его полностью. Владельцу следует читать руководство и не класть внутрь вещи, которые вы не готовы умножить.
          </div>
        </div>
        <div class="card">
          <!-- IMAGE BRIEF: изометрический рендер Multiplyr Fridge на темном фоне, тонкая каемка подсветки; рядом небольшие пиктограммы сенсоров. 1:1. -->
          <img id="img-isometric" src="images/isometric.png" alt="Multiplyr Fridge — изометрия" style="width:100%;height:340px;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,.06)" />
          <p style="color:var(--muted);margin-top:10px">В комплекте руководство пользователя и наклейка «я дружу с вероятностью».</p>
        </div>
      </div>
    </section>

    <section id="preorder" class="wrap">
      <h2 class="section-title">Предзаказ</h2>
      <p class="section-lead">Первая партия ограничена. Оставьте почту и получите приглашение. Оплата при отгрузке. Монстр не входит в комплект.</p>
      <form class="card" onsubmit="event.preventDefault(); this.querySelector('button').textContent='Заявка отправлена';">
        <div style="display:grid;grid-template-columns:2fr 1fr;gap:12px;align-items:center">
          <input type="email" required placeholder="ваш@email" style="padding:14px 16px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#0f1420;color:var(--text)">
          <button class="btn primary" type="submit">Оставить заявку</button>
        </div>
        <p style="color:var(--muted);margin:10px 0 0;font-size:14px">Нажимая кнопку, вы соглашаетесь с вероятностной природой результата.</p>
      </form>
    </section>

    <section id="faq" class="wrap">
      <h2 class="section-title">FAQ</h2>
      <div class="grid">
        <article class="card"><h3>Из чего появляется еда</h3><p>Из уже положенных продуктов. Multiplyr переупаковывает, клонирует текстуры и меняет пропорции. Создания «из ничего» нет.</p></article>
        <article class="card"><h3>Как часто выпадает монстр</h3><p>Редко. Точный процент плавает и зависит от множества факторов. Включайте режим Антимонстр и читайте руководство.</p></article>
        <article class="card"><h3>Можно ли отключить влияние Луны</h3><p>Нет. Но можно сгладить влияние через стабильные ритмы в доме и спокойный плейлист.</p></article>
        <article class="card"><h3>Что делать при появлении монстра</h3><p>Не кормить. Не смотреть в глаза. Закрыть дверцу и активировать протокол возврата содержимого. Подробности в руководстве.</p></article>
        <article class="card"><h3>Подходит для детей</h3><p>Да, при включённой детской защите и нулевом доступе к режимам Праздничный и Ночная кухня.</p></article>
        <article class="card">
          <!-- IMAGE BRIEF: смешной, нестрашный «монстр из холодильника» в стилистике дружелюбного графического персонажа; тёмный фон, лёгкое неоновое свечение. 16:9. -->
          <img id="img-monster" src="images/monster.png" alt="Дружелюбный монстр" style="width:100%;height:180px;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,.06)" />
          <h3>Он правда такой страшный</h3><p>Чаще просто любопытный. Но мы обязаны предупредить.</p>
        </article>
      </div>
    </section>
  </main>

  <footer>
    <div class="wrap">© Multiplyr Lab. Вероятность прекрасного всегда выше нуля.</div>
  </footer>

  <script>
    const els = ['moon','weather','mood','purr','wifi','cosmic'].map(id=>document.getElementById(id));
    const out = document.getElementById('out');
    function calc(){
      const moon = +document.getElementById('moon').value;      // 0..100
      const weather = +document.getElementById('weather').value; // 930..1040
      const mood = +document.getElementById('mood').value;       // 0..100
      const purr = +document.getElementById('purr').value;       // 20..40
      const wifi = +document.getElementById('wifi').value;       // 1..13
      const cosmic = +document.getElementById('cosmic').value;   // 0..100

      // Небольшая шутливая математика для иллюстрации
      let base = 0.45;
      base += (moon-50)/1000;                 // луна
      base += (weather-985)/3000;             // давление
      base += (mood-50)/800;                  // настроение
      base += (purr-30)/200;                  // кот
      base -= Math.abs(wifi-6)/120;           // соседский канал
      base += (50-cosmic)/900;                // космические лучи

      let food = Math.max(0, Math.min(0.9, base));
      let perfect = Math.max(0, Math.min(0.5, 0.1 + (mood/100)*0.2 + (50-Math.abs(moon-50))/400));
      let monster = Math.max(0.01, 1 - (food + perfect));

      // нормировка
      const s = food + perfect + monster;
      food/=s; perfect/=s; monster/=s;

      const fmt = x => (x*100).toFixed(1)+"%";
      const verdict = monster>0.18? 'Риск монстра заметен. Включите Антимонстр.' : (perfect>0.33? 'Шанс идеального блюда высокий.' : 'Ожидается аккуратное приумножение.');

      out.innerHTML = `
        <div><strong>Приумножение:</strong> ${fmt(food)} • <strong>Идеальное блюдо:</strong> ${fmt(perfect)} • <strong>Монстр:</strong> ${fmt(monster)}</div>
        <div style="margin-top:6px;color:${monster>0.18?'#ffd6d6':'#a3f7cf'}">${verdict}</div>
      `;
    }
    els.forEach(e=>e.addEventListener('input',calc));
    calc();
  </script>
</body>
</html>
